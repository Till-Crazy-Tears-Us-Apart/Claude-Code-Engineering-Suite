# Deep Plan (深度计划审计)

Deep Plan 是一个**零代码 (Zero-Code)** 的架构审计协议。它强制 AI 在编写任何实现代码之前，先完成彻底的歧义消除、不变量定义和逻辑预演。其核心原则是“先决策，后编码”。

## 核心流程

1.  **Context Saturation (上下文饱和)**:
    *   AI 必须首先读取所有相关代码，特别是被调用的底层定义。
    *   禁止基于猜测或不完整信息制定计划。

2.  **Interactive Ambiguity Resolution (交互式歧义消除)**:
    *   如果存在多个技术路径（例如：用 Regex 还是 AST？用 Redis 还是内存？），AI **必须**暂停并使用 `AskUserQuestion` 询问用户。
    *   循环直到所有“待定 (TBD)”项都被转化为“锁定 (Fixed)”的约束。

3.  **Strict Audit (严格审计)**:
    *   一旦歧义消除，AI 将生成一份包含 4 张表的审计报告（详见输出格式）。

## 输出格式 (审计报告)

Deep Plan 最终会输出以下四张表格：

### 1. 🧩 歧义消除矩阵 (Ambiguity Resolution Matrix)
记录所有被识别出的决策点及其最终锁定的方案。任何未锁定的歧义都会导致计划被拒绝。

### 2. 🧪 PBT 属性规约 (Property-Based Testing Spec)
定义代码必须满足的数学不变量（如：幂等性、可逆性）。这指导了后续测试用例的编写。

### 3. ⚖️ 逻辑与契约审计 (Logic & Contract Audit)
检查数据流一致性、复杂度 (Big-O)、并发风险（死锁/竞态）及系统副作用。

### 4. 🛠️ 物理变更预演 (Physical Change Simulation)
列出将要修改的每一个文件、函数及具体操作类型，并预估涟漪效应（Ripple Effect）。

## 何时使用

*   **复杂重构**: 修改核心逻辑或公共组件时。
*   **新功能开发**: 功能需求尚不明确，或存在多种实现路径时。
*   **高风险操作**: 涉及数据迁移、权限变更或不可逆操作时。

## 禁止事项

*   **禁止写代码**: 在本阶段，AI 被严格禁止生成或修改任何实现代码。
*   **禁止假定**: AI 不得假设用户的意图，必须通过询问确认。
